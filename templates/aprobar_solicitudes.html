{% extends "base.html" %}

{% block title %}Aprobar Solicitudes{% endblock %}

{% block content %}
<h1 class="mb-4"><i class="bi bi-check-circle"></i> Solicitudes Pendientes</h1>

<div class="card mb-4">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="bi bi-calendar-check"></i> Vacaciones</h5>
    </div>
    <div class="card-body">
        {% if solicitudes_vac %}
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>Empleado</th>
                        <th>Desde</th>
                        <th>Hasta</th>
                        <th>Días</th>
                        <th>Motivo</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sol in solicitudes_vac %}
                    <tr>
                        <td>
                            <div class="fw-bold">{{ sol.usuario.nombre }}</div>
                            {% if sol.version > 1 %}
                            <span class="badge bg-warning text-dark" style="font-size: 0.75em;">v{{sol.version}}</span>
                            {% endif %}

                            {% if sol.dias_adelanto and sol.dias_adelanto > 0 %}
                            <span class="badge bg-info text-dark mt-1"
                                title="Esta solicitud consume días del año siguiente">
                                <i class="bi bi-info-circle"></i> Adelanto: {{ sol.dias_adelanto }} días
                            </span>
                            {% endif %}
                            {% if sol.tipo_accion == 'modificacion' %}
                            <span class="badge bg-warning text-dark mt-1">Modificación</span>
                            <div class="small text-muted">Versión v{{ sol.version }}</div>
                            {% elif sol.tipo_accion == 'cancelacion' %}
                            <span class="badge bg-danger mt-1">Petición de Cancelación</span>
                            {% endif %}
                        </td>
                        <td>{{ sol.fecha_inicio.strftime('%d/%m/%Y') }}</td>
                        <td>{{ sol.fecha_fin.strftime('%d/%m/%Y') }}</td>
                        <td>
                            <span class="badge bg-secondary">{{ sol.dias_solicitados }}</span>
                        </td>
                        <td><small>{{ sol.motivo }}</small></td>
                        <td>
                            <div class="btn-group">
                                <form method="POST"
                                    action="{{ url_for('ausencias.responder_solicitud', id=sol.id, accion='aprobar') }}"
                                    class="approve-request-form">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="button" class="btn btn-sm btn-success me-1 approve-request-btn"
                                        data-tipo="vacaciones" data-usuario="{{ sol.usuario.nombre }}"
                                        data-fechas="{{ sol.fecha_inicio.strftime('%d/%m') }} - {{ sol.fecha_fin.strftime('%d/%m') }}"
                                        data-dias="{{ sol.dias_solicitados }}" title="Aprobar"><i
                                            class="bi bi-check-lg"></i></button>
                                </form>
                                <form method="POST"
                                    action="{{ url_for('ausencias.responder_solicitud', id=sol.id, accion='rechazar') }}"
                                    class="reject-request-form">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="button" class="btn btn-sm btn-danger reject-request-btn"
                                        data-tipo="vacaciones" data-usuario="{{ sol.usuario.nombre }}"
                                        data-fechas="{{ sol.fecha_inicio.strftime('%d/%m') }} - {{ sol.fecha_fin.strftime('%d/%m') }}"
                                        title="Rechazar"><i class="bi bi-x-lg"></i></button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">No hay vacaciones pendientes.</p>
        {% endif %}
    </div>
</div>

<div class="card">
    <div class="card-header bg-danger text-white">
        <h5 class="mb-0"><i class="bi bi-bandaid"></i> Bajas y Ausencias</h5>
    </div>
    <div class="card-body">
        {% if solicitudes_bajas %}
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th>Empleado</th>
                        <th>Tipo</th>
                        <th>Desde</th>
                        <th>Hasta</th>
                        <th>Detalle</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for sol in solicitudes_bajas %}
                    <tr>
                        <td>
                            <div class="fw-bold">{{ sol.usuario.nombre }}</div>
                            {% if sol.version > 1 %}
                            <span class="badge bg-warning text-dark" style="font-size: 0.75em;">v{{sol.version}}</span>
                            {% endif %}
                        </td>
                        <td>
                            {% if sol.tipo_ausencia %}
                            <span class="badge bg-info text-dark">{{ sol.tipo_ausencia.nombre }}</span>
                            {% else %}
                            <span class="badge bg-light text-dark border">Genérica</span>
                            {% endif %}
                        </td>
                        <td>{{ sol.fecha_inicio.strftime('%d/%m/%Y') }}</td>
                        <td>{{ sol.fecha_fin.strftime('%d/%m/%Y') }}</td>
                        <td><small>{{ sol.motivo }}</small></td>
                        <td>
                            <div class="btn-group">
                                <form method="POST"
                                    action="{{ url_for('ausencias.responder_baja', id=sol.id, accion='aprobar') }}"
                                    class="approve-request-form">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="button" class="btn btn-sm btn-success me-1 approve-request-btn"
                                        data-tipo="baja" data-usuario="{{ sol.usuario.nombre }}"
                                        data-fechas="{{ sol.fecha_inicio.strftime('%d/%m') }} - {{ sol.fecha_fin.strftime('%d/%m') }}"
                                        data-dias="{{ sol.dias_solicitados }}" title="Aprobar"><i
                                            class="bi bi-check-lg"></i></button>
                                </form>
                                <form method="POST"
                                    action="{{ url_for('ausencias.responder_baja', id=sol.id, accion='rechazar') }}"
                                    class="reject-request-form">
                                    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                    <button type="button" class="btn btn-sm btn-danger reject-request-btn"
                                        data-tipo="baja" data-usuario="{{ sol.usuario.nombre }}"
                                        data-fechas="{{ sol.fecha_inicio.strftime('%d/%m') }} - {{ sol.fecha_fin.strftime('%d/%m') }}"
                                        title="Rechazar"><i class="bi bi-x-lg"></i></button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-muted mb-0">No hay bajas pendientes.</p>
        {% endif %}
    </div>
</div>

{% block extra_js %}
<script src="{{ url_for('static', filename='js/modal_confirmations.js') }}"></script>
{% endblock %}